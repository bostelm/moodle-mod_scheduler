{"version":3,"file":"revoke.min.js","sources":["../src/revoke.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Revoke an appointment.\n *\n * This module allows for revoking an appointment from a student list.\n *\n * @module     mod_scheduler/revoke\n * @copyright  2019 Royal College of Art\n * @author     Frédéric Massart <fred@branchup.tech>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str'], function($, Ajax, Notification, Str) {\n\n    var actionSelector = '.otherstudent a.revoke-student';\n    var studentWrapperSelector = '.otherstudent';\n\n    /**\n     * Revoker.\n     *\n     * @param {jQuery} root The root wrapper as jQuery element.\n     * @param {Number} cmid The cmid.\n     */\n    function Revoker(root, cmid) {\n        this.cmid = cmid;\n\n        root.on('click', actionSelector, function(e) {\n            e.preventDefault();\n            var wrapper = $(e.target).closest(studentWrapperSelector);\n            this.triggerRevoke(wrapper);\n        }.bind(this));\n    }\n\n    /**\n     * Trigger the revoke from a node.\n     *\n     * @param {jQuery} studentWrapper The student wrapper node.\n     */\n    Revoker.prototype.triggerRevoke = function(studentWrapper) {\n        var appId = parseInt(studentWrapper.data('appointmentid'), 10);\n        if (!appId) {\n            return;\n        }\n\n        Str.get_strings([\n            {key: 'confirmation', component: 'core_admin'},\n            {key: 'confirmsinglerevoke', component: 'mod_scheduler'},\n            {key: 'yes', component: 'core'},\n            {key: 'no', component: 'core'}\n        ]).then(function(str) {\n            Notification.confirm(str[0], str[1], str[2], str[3], function() {\n                // The user confirmed.\n                studentWrapper.hide();\n                this.revokeAppointment(appId).then(function() {\n                    studentWrapper.remove();\n                    return;\n                }).fail(function(e) {\n                    studentWrapper.show();\n                    Notification.exception(e);\n                });\n            }.bind(this), function() {\n                // The user cancelled.\n            });\n        }.bind(this)).fail(Notification.exception);\n    };\n\n    /**\n     * Revoke an appointment.\n     *\n     * @param {Number} appId The appointment ID.\n     * @return {Deferred}\n     */\n    Revoker.prototype.revokeAppointment = function(appId) {\n        return Ajax.call([{\n            methodname: 'mod_scheduler_revoke_appointment',\n            args: {\n                cmid: this.cmid,\n                appointmentid: appId\n            }\n        }])[0];\n    };\n\n    return {\n        init: function(wrapperSelector, cmid) {\n            new Revoker($(wrapperSelector), cmid);\n        }\n    };\n\n});\n"],"names":["define","$","Ajax","Notification","Str","Revoker","root","cmid","on","e","preventDefault","wrapper","target","closest","triggerRevoke","bind","this","prototype","studentWrapper","appId","parseInt","data","get_strings","key","component","then","str","confirm","hide","revokeAppointment","remove","fail","show","exception","call","methodname","args","appointmentid","init","wrapperSelector"],"mappings":";;;;;;;;;;AA0BAA,8BAAO,CAAC,SAAU,YAAa,oBAAqB,aAAa,SAASC,EAAGC,KAAMC,aAAcC,cAWpFC,QAAQC,KAAMC,WACdA,KAAOA,KAEZD,KAAKE,GAAG,QAZS,iCAYgB,SAASC,GACtCA,EAAEC,qBACEC,QAAUV,EAAEQ,EAAEG,QAAQC,QAbL,sBAchBC,cAAcH,UACrBI,KAAKC,cAQXX,QAAQY,UAAUH,cAAgB,SAASI,oBACnCC,MAAQC,SAASF,eAAeG,KAAK,iBAAkB,IACtDF,OAILf,IAAIkB,YAAY,CACZ,CAACC,IAAK,eAAgBC,UAAW,cACjC,CAACD,IAAK,sBAAuBC,UAAW,iBACxC,CAACD,IAAK,MAAOC,UAAW,QACxB,CAACD,IAAK,KAAMC,UAAW,UACxBC,KAAK,SAASC,KACbvB,aAAawB,QAAQD,IAAI,GAAIA,IAAI,GAAIA,IAAI,GAAIA,IAAI,GAAI,WAEjDR,eAAeU,YACVC,kBAAkBV,OAAOM,MAAK,WAC/BP,eAAeY,YAEhBC,MAAK,SAAStB,GACbS,eAAec,OACf7B,aAAa8B,UAAUxB,OAE7BM,KAAKC,OAAO,gBAGhBD,KAAKC,OAAOe,KAAK5B,aAAa8B,YASpC5B,QAAQY,UAAUY,kBAAoB,SAASV,cACpCjB,KAAKgC,KAAK,CAAC,CACdC,WAAY,mCACZC,KAAM,CACF7B,KAAMS,KAAKT,KACX8B,cAAelB,UAEnB,IAGD,CACHmB,KAAM,SAASC,gBAAiBhC,UACxBF,QAAQJ,EAAEsC,iBAAkBhC"}